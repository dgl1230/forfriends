{% extends 'base.html' %}
{% block content %}

{% if questions.has_next %}
<script type="text/javascript">
	// TOUCH-EVENTS SINGLE-FINGER SWIPE-SENSING JAVASCRIPT
	// Courtesy of PADILICIOUS.COM and MACOSXAUTOMATION.COM
	
	// this script can be used with one or more page elements to perform actions based on them being swiped with a single finger

	var triggerElementID = null; // this variable is used to identity the triggering element
	var fingerCount = 0;
	var startX = 0;
	var startY = 0;
	var curX = 0;
	var curY = 0;
	var deltaX = 0;
	var deltaY = 0;
	var horzDiff = 0;
	var vertDiff = 0;
	var minLength = 72; // the shortest distance the user may swipe
	var swipeLength = 0;
	var swipeAngle = null;
	var swipeDirection = null;
	
	// The 4 Touch Event Handlers
	
	// NOTE: the touchStart handler should also receive the ID of the triggering element
	// make sure its ID is passed in the event call placed in the element declaration, like:
	// <div id="picture-frame" ontouchstart="touchStart(event,'picture-frame');"  ontouchend="touchEnd(event);" ontouchmove="touchMove(event);" ontouchcancel="touchCancel(event);">

	function touchStart(event,passedName) {
		// disable the standard ability to select the touched object
		event.preventDefault();
		// get the total number of fingers touching the screen
		fingerCount = event.touches.length;
		// since we're looking for a swipe (single finger) and not a gesture (multiple fingers),
		// check that only one finger was used
		if ( fingerCount == 1 ) {
			// get the coordinates of the touch
			startX = event.touches[0].pageX;
			startY = event.touches[0].pageY;
			// store the triggering element ID
			triggerElementID = passedName;
		} else {
			// more than one finger touched so cancel
			touchCancel(event);
		}
	}

	function touchMove(event) {
		event.preventDefault();
		if ( event.touches.length == 1 ) {
			curX = event.touches[0].pageX;
			curY = event.touches[0].pageY;
		} else {
			touchCancel(event);
		}
	}
	
	function touchEnd(event) {
		event.preventDefault();
		// check to see if more than one finger was used and that there is an ending coordinate
		if ( fingerCount == 1 && curX != 0 ) {
			// use the Distance Formula to determine the length of the swipe
			swipeLength = Math.round(Math.sqrt(Math.pow(curX - startX,2) + Math.pow(curY - startY,2)));
			// if the user swiped more than the minimum length, perform the appropriate action
			if ( swipeLength >= minLength ) {
				caluculateAngle();
				determineSwipeDirection();
				processingRoutine();
				touchCancel(event); // reset the variables
			} else {
				touchCancel(event);
			}	
		} else {
			touchCancel(event);
		}
	}

	function touchCancel(event) {
		// reset the variables back to default values
		fingerCount = 0;
		startX = 0;
		startY = 0;
		curX = 0;
		curY = 0;
		deltaX = 0;
		deltaY = 0;
		horzDiff = 0;
		vertDiff = 0;
		swipeLength = 0;
		swipeAngle = null;
		swipeDirection = null;
		triggerElementID = null;
	}
	
	function caluculateAngle() {
		var X = startX-curX;
		var Y = curY-startY;
		var Z = Math.round(Math.sqrt(Math.pow(X,2)+Math.pow(Y,2))); //the distance - rounded - in pixels
		var r = Math.atan2(Y,X); //angle in radians (Cartesian system)
		swipeAngle = Math.round(r*180/Math.PI); //angle in degrees
		if ( swipeAngle < 0 ) { swipeAngle =  360 - Math.abs(swipeAngle); }
	}
	
	function determineSwipeDirection() {
		if ( (swipeAngle <= 45) && (swipeAngle >= 0) ) {
			swipeDirection = 'left';
		} else if ( (swipeAngle <= 360) && (swipeAngle >= 315) ) {
			swipeDirection = 'left';
		} else if ( (swipeAngle >= 135) && (swipeAngle <= 225) ) {
			swipeDirection = 'right';
		} else if ( (swipeAngle > 45) && (swipeAngle < 135) ) {
			swipeDirection = 'down';
		} else {
			swipeDirection = 'up';
		}
	}
	
	function processingRoutine() {
		var swipedElement = document.getElementById("question_answers");
		if ( swipeDirection == 'left' ) {
			// REPLACE WITH YOUR ROUTINES
			window.location.href = "?page={{ questions.next_page_number }}";
		}
	}

</script>
{% endif %}

<div id="big_wrapper">
<div class="row" id="margin_wrapper">
	<div class="col-md-1" id="secondary_navbar">
        <h1>Personality</h1>
	</div>
	<div class="col-md-1" id="tertiary_navbar">
		<span class="glyphicon glyphicon-question-sign" id="tertiary-icon"></span>
     	<a href="/questions/edit/">Edit Answers</a>
     	<span class="glyphicon glyphicon-question-sign" id="tertiary-icon"></span>
	</div>
</div>

{% if messages %}
<div class="row">
<div class="col-md-1" id="tertiary_navbar">
    {% for message in messages %}
    <p id="questions_messages"{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
    {% endfor %}
</div>
</div>
{% endif %}


	<div class='row' id="interests_intro">
		<div class='interests_intro'>
		</div>
	</div>
<div class='row' id="question-wrapper">
	{% for question in questions %}
		<h3>{{ question }}</h3>

		<form method='POST' action=''> {% csrf_token %}
			<input type='hidden' value='{{ question.id }}' name='question_id'/>

		<div class="question_answers" id="question_answers" ontouchstart="touchStart(event,'main_interests');" ontouchend="touchEnd(event);" ontouchmove="touchMove(event);" ontouchcancel="touchCancel(event);">
		{% for ans in question.answer_set.all %}
			<input type='radio' required=
			'required' value='{{ ans }}' {% for abc in ans.useranswer_set.all %} {% if abc and abc.user == request.user %} checked='checked' {% endif %} {% endfor %} name='answer'> {{ ans }} <br/>
		{% endfor %}
		</div>
		<br>
		<div class="importance_wrapper">
		<div class="input select rating-b">
		            <label for="example-b">How important is this question to you?</label>
		            <br><br>

		            <select id="example-b" name="importance_level">
		            	{% for imp in importance_levels %}
		                <option {% for abc in question.useranswer_set.all %} {% if abc.importance_level == imp and abc.user == request.user %} selected="selected" value="{{ imp }}"{% endif %} {% endfor %}> {{ imp }}</option>
		               {% endfor %}
		            </select>
		        </div>
		    </div>
		<br><br><br>

		<!-- Submit Button -->
		<input type='submit' class='btn-lg' value='Save'>
		
	</form>
		<div class="interest_buttons">
						<div class="buttons">
			            <button class="blue-pill deactivated rating-enable">enable</button>
			            <button class="blue-pill rating-disable">disable</button>
			        	</div>
	{% endfor %}

	<br><br>
		</div>	
<div class="pagination">
	<span class="step-links">
		<ul class="pager">
			<div class="directions">
				{% if questions.has_previous %}
					<li class="previous"><a href="?page={{ questions.previous_page_number }}">&larr; Previous</a></li>
				{% endif %}

				{% if questions.has_next %}
					<li class="next"><a href="?page={{ questions.next_page_number }}">Next &rarr;</a></li>
				{% endif %}
			</div>
		</ul>
	</span>
</div>
</div>
</div>
</div>

<script>
        $(function () {
            $('.rating-enable').click(function () {
                
                $('#example-b').barrating('show', {
                    readonly:false,

                });

                $('.rating-disable').removeClass('deactivated');
            });
            $('.rating-enable').trigger('click');
        });
</script>

{% if questions.has_previous %}
<script>

$(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
        
        window.location = "?page={{ questions.previous_page_number }}";
        break;

        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});
</script>

{% endif %}
{% if questions.has_next %}

<script>
	$(document).keydown(function(e) {
    switch(e.which) {
        case 39: // right
        window.location = "?page={{ questions.next_page_number }}";
        break;

        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});
</script>

{% endif %}

{% endblock %}