{% extends 'base.html' %}

{% block content %}
<div id="pictures">
  <div class="row" id="view_container">
    <div class="col-md-1" id="secondary_navbar">

          <h1>Pictures</h1>
    </div>
    <div class="col-md-1" id="tertiary_navbar">
       <a href="#add_more_pictures" id="upload_more">Add Pictures</a>
    </div>
  </div>
  <div id="myDiv"></div>
        <!-- carousel data -->
        <div id="carouselData">
          
          <!-- image datalist category 1 -->
          <ul data-cat="Category one" style="display:none">  {% for pic in pictures %}     
            <ul>
              <li data-type="media" data-url="{{ MEDIA_URL }}{{ pic }}" data-target="_blank"></li>
              <li data-thumbnail-path="{{ MEDIA_URL }}{{ pic }}"></li>
              <li data-thumbnail-text="{{ pic.caption }}" data-thumbnail-text-title-offset="35"
              data-thumbnail-text-offset-top="10" data-thumbnail-text-offset-bottom="0">

                <p class="smallLabel" id="delete_picture"><a href='/'><span style="color:white"class="glyphicon glyphicon-trash"></a></p>
                
              </li>
              <li data-info="">
                <p class="mediaDescriptionHeader">{{ pic.caption }}</p>
              </li>
            </ul>
            {% endfor %}
          </ul>
          <!-- end  -->
          <!-- end  -->
        </div>
    <br>
      
    </div>
    <br> 

      <div class="bbody" id="add_more_pictures">

      <!-- upload form -->
      <form id="upload_form" enctype="multipart/form-data" method="post" action='{% url "new_picture" %}' onsubmit="return checkForm()"> {% csrf_token %}
          <!-- hidden crop params -->
        <p class="step1">Please select an image file</p>

            <div>
                <input id="image_file" name="image_file" onchange=
                "fileSelectHandler()" type="file">
            </div>
            <br>

            <div class="error"></div>

            <div class="step2">
                <p>Please select a crop region</p>
                <img id="preview" />
                <br>
                <div style="width:100px; height:100px; overflow:hidden;margin-left:5px">
                    <img id="small_preview" name="small_preview" />
                </div>
                <br>
            </div>
            <br>
            <div class="caption">
                <label>Caption:</label> 
                <textarea cols="20" id="caption" name="caption" rows="3">
                </textarea>
            </div>
            <br>
            <input class="btn" id="upload_button" type="submit" value="Upload">
        </form>

<div>
    <div class="example">
            <div class="example__left" style="padding-top:120px">
                <div id="userpic" class="userpic">
                    <div class="js-preview userpic__preview"></div>
                    <div class="btn btn-success js-fileapi-wrapper">
                        <div class="js-browse">
                            <span class="btn-txt">Choose</span>
                            <input type="file" name="filedata"/>
                        </div>
                        <div class="js-upload" style="display: none;">
                            <div class="progress progress-success"><div class="js-progress bar"></div></div>
                            <span class="btn-txt">Uploading</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<script>
// convert bytes into friendly format
function bytesToSize(bytes) {
        var sizes = ['Bytes', 'KB', 'MB'];
        if (bytes === 0) return 'n/a';
        var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
    }
    // check for selected crop region



function showPreview(coords) {
        var rx = 100 / coords.w;
        var ry = 100 / coords.h;
        $('#small_preview').css({
            width: Math.round(rx * 500) + 'px',
            height: Math.round(ry * 370) + 'px',
            marginLeft: '-' + Math.round(rx * coords.x) + 'px',
            marginTop: '-' + Math.round(ry * coords.y) + 'px'
        }).show();
    }
    // update info by cropping (onChange and onSelect events handler)

function updateInfo(e) {
        $('#x1').val(e.x);
        $('#y1').val(e.y);
        $('#x2').val(e.x2);
        $('#y2').val(e.y2);
        $('#w').val(e.w);
        $('#h').val(e.h);
    }
    // clear info by cropping (onRelease event handler)

function clearInfo() {
        $('.info #w').val('');
        $('.info #h').val('');
    }
    // Create variables (in this scope) to hold the Jcrop API and image size
var jcrop_api, boundx, boundy;

function fileSelectHandler() {
    // get selected file
    var oFile = $('#image_file')[0].files[0];
    // hide all errors
    $('.error').hide();
    // check for image type (jpg and png are allowed)
    var rFilter = /^(image\/jpeg|image\/png)$/i;
    if (!rFilter.test(oFile.type)) {
        $('.error').html(
            'Please select a valid image file (jpg and png are allowed)'
        ).show();
        return;
    }
    // check for file size
    if (oFile.size > 10000 * 1024) {
        $('.error').html('Please select a smaller image file').show();
        return;
    }
    if (oFile.size < 2500) {
        $('.error').html(
            'You have selected too small of a file, please select a larger image file'
        ).show();
        return;
    }
    // preview element
    var oImage = document.getElementById('preview');
    // prepare HTML5 FileReader
    var oReader = new FileReader();
    oReader.onload = function(e) {
        // e.target.result contains the DataURL which we can use as a source of the image
        oImage.src = e.target.result;
        oImage.onload = function() { // onload event handler
            // display step 2
            $('.step2').fadeIn(500);
            // display some basic image info
            var sResultFileSize = bytesToSize(oFile.size);
            $('#filesize').val(sResultFileSize);
            $('#filetype').val(oFile.type);
            $('#filedim').val(oImage.naturalWidth + ' x ' + oImage.naturalHeight);
            // destroy Jcrop if it is existed
            if (typeof jcrop_api != 'undefined') {
                jcrop_api.destroy();
                jcrop_api = null;
                $('#preview').width(oImage.naturalWidth);
                $('#preview').height(oImage.naturalHeight);
            }
            setTimeout(function() {
                // initialize Jcrop
                $('#preview').Jcrop({
                    onChange: updateInfo,
                    onSelect: updateInfo,
                    minSize: [200, 250], // min crop size
                    maxSize: [800, 1000], // max crop size
                    aspectRatio: 1, // keep aspect ratio 1:1
                    
                }, function() {
                    // use the Jcrop API to get the real image size
                    var bounds = this.getBounds();
                    boundx = bounds[0];
                    boundy = bounds[1];
                    // Store the Jcrop API in the jcrop_api variable
                    jcrop_api = this;
                });
            }, 3000);
        };
    };
    // read selected file as DataURL
    oReader.readAsDataURL(oFile);
}
</script>

<!-- Circle Carousel -->
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDPage.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarModTweenMax.js" type="text/javascript"></script>
     <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarUtils.js" type="text/javascript"></script>
     <script src="{{ STATIC_URL }}js/3dcarousel/FWDRoyal3DCarousel_uncompressed.js" type="text/javascript"></script>
     <script src="{{ STATIC_URL }}js/3dcarousel/FWDRoyal3DCarousel.js" type="text/javascript"></script>
     <script src="{{ STATIC_URL }}js/FWDRoyal3DCarousel.js" type="text/javascript"></script>
 
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarColorPropsPlugin.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarComboBox.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarComboBoxButton.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarComboBoxSelector.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarComplexButton.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarContextMenu.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarData.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarDisplayObject.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarDisplayObject3D.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarEventDispatcher.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarInfo.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarInfoWindow.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarLightBox.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarPreloader.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarScrollbar.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarSimpleButton.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarSimpleDisplayObject.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarSlideshowButton.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarSlideShowPreloader.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarThumb.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDR3DCarThumbsManager.js" type="text/javascript"></script>  
    <script src="{{ STATIC_URL }}js/3dcarousel/FWDRoyal3DCarousel_uncompressed.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/3dcarousel/initiate.js" type="text/javascript"></script>
    <script>
                    FWDR3DCarUtils.onReady(function(){
                var carousel = new FWDRoyal3DCarousel({
                    //required settings
                    carouselHolderDivId:"myDiv",
                    carouselDataListDivId:"carouselData",
                    displayType:"responsive",
                    autoScale:"yes",
                    carouselWidth:940,
                    carouselHeight:538,
                    skinPath:"{{ STATIC_URL }}img/skin_modern_silver",
                    //main settings
                    backgroundColor:"none",
                    backgroundImagePath:"",
                    thumbnailsBackgroundImagePath:"",
                    scrollbarBackgroundImagePath:"",
                    backgroundRepeat:"repeat-x",
                    showDisplay2DAlways:"no",
                    carouselStartPosition:"center",
                    numberOfThumbnailsToDisplayLeftAndRight:4,
                    slideshowDelay:5000,
                    autoplay:"no",
                    showPrevButton:"yes",
                    showNextButton:"yes",
                    showSlideshowButton:"yes",
                    disableNextAndPrevButtonsOnMobile:"no",
                    controlsMaxWidth:940,
                    slideshowTimerColor:"#777777",  
                    showContextMenu:"no",
                    addKeyboardSupport:"yes",
                    //thumbnail settings
                    thumbnailWidth:420,
                    thumbnailHeight:286,
                    thumbnailSpaceOffset3D:-19,
                    thumbnailSpaceOffset2D:-19,
                    thumbnailBorderSize:10,
                    thumbnailBackgroundColor:"#666666",
                    thumbnailBorderColor1:"#fcfdfd",
                    thumbnailBorderColor2:"#e4e4e4",
                    transparentImages:"no",
                    maxNumberOfThumbnailsOnMobile:13,
                    showThumbnailsGradient:"yes",
                    showThumbnailsHtmlContent:"no",
                    textBackgroundColor:"#333333",
                    textBackgroundOpacity:.7,
                    showText:"yes",
                    showTextBackgroundImage:"yes",
                    showThumbnailBoxShadow:"yes",
                    thumbnailBoxShadowCss:"0px 2px 2px #555555",
                    showReflection:"yes",
                    reflectionHeight:60,
                    reflectionDistance:0,
                    reflectionOpacity:.2,
                    //scrollbar settings
                    showScrollbar:"yes",
                    disableScrollbarOnMobile:"yes",
                    enableMouseWheelScroll:"yes",
                    scrollbarHandlerWidth:300,
                    scrollbarTextColorNormal:"#777777",
                    scrollbarTextColorSelected:"#000000",   
                    //combobox settings
                    showComboBox:"no",
                    startAtCategory:1,
                    selectLabel:"SELECT CATEGORIES",
                    allCategoriesLabel:"All Categories",
                    showAllCategories:"yes",
                    comboBoxPosition:"topright",
                    selectorBackgroundNormalColor1:"#fcfdfd",
                    selectorBackgroundNormalColor2:"#e4e4e4",
                    selectorBackgroundSelectedColor1:"#a7a7a7",
                    selectorBackgroundSelectedColor2:"#8e8e8e",
                    selectorTextNormalColor:"#8b8b8b",
                    selectorTextSelectedColor:"#FFFFFF",
                    buttonBackgroundNormalColor1:"#e7e7e7",
                    buttonBackgroundNormalColor2:"#e7e7e7",
                    buttonBackgroundSelectedColor1:"#a7a7a7",
                    buttonBackgroundSelectedColor2:"#8e8e8e",
                    buttonTextNormalColor:"#000000",
                    buttonTextSelectedColor:"#FFFFFF",
                    comboBoxShadowColor:"#000000",
                    comboBoxHorizontalMargins:12,
                    comboBoxVerticalMargins:12,
                    comboBoxCornerRadius:0,
                    //lightbox settings
                    addLightBoxKeyboardSupport:"yes",
                    showLightBoxNextAndPrevButtons:"yes",
                    showLightBoxZoomButton:"yes",
                    showLightBoxInfoButton:"yes",
                    showLighBoxSlideShowButton:"yes",
                    showLightBoxInfoWindowByDefault:"no",
                    slideShowAutoPlay:"no",
                    lightBoxVideoAutoPlay:"no",
                    lightBoxVideoWidth:640,
                    lightBoxVideoHeight:480,
                    lightBoxIframeWidth:800,
                    lightBoxIframeHeight:600,
                    lightBoxBackgroundColor:"#000000",
                    lightBoxInfoWindowBackgroundColor:"#FFFFFF",
                    lightBoxItemBorderColor1:"#fcfdfd",
                    lightBoxItemBorderColor2:"#e4FFe4",
                    lightBoxItemBackgroundColor:"#333333",
                    lightBoxMainBackgroundOpacity:.8,
                    lightBoxInfoWindowBackgroundOpacity:.9,
                    lightBoxBorderSize:5,
                    lightBoxBorderRadius:0,
                    lightBoxSlideShowDelay:4000
                }); 
            })
    </script>

<script> 
    $("#upload_more").click(function() {
        $(".bbody").toggle(function() {

        });
    });
</script>
{% endblock %}
