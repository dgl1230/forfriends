{% extends 'base.html' %}

<link href="{{ STATIC_URL }}css/messages.css" rel="stylesheet">



{% block content %}

<div id="view_container">
<div class="row">
	<div class="col-md-1" id="secondary_navbar">
        <h1 align="center">Inbox</h1>
	</div>
	<div class="col-md-1" id="tertiary_navbar">
 		<a href="/messages/compose/" class="half-nav1">New Message</a>
 		<span class= 'glyphicon glyphicon-envelope' id="tertiary-icon"></span>
 		<a href="/messages/sent/" class="half-nav2">Sent Messages</a>
	</div>
</div>
<div class='row'>
    <div class="col-md-1" id="tertiary_navbar">
      {% for message in messages %}
        <p {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
      {% endfor %}
    </div>
</div>
<br>
<div class="container" id="message_body_holder">
  <div class='col-lg-10 col-12' id="message_body_container">
	<div class="body_section">
	<table class='table table-striped' id="items_table">
		<thead>
		<th>From</th> <th>Message</th> <th> <a><span id="inbox_trash" class="glyphicon glyphicon-trash"></a></span></th>
		</thead>
		<tbody>
			{% for item in messages_in_inbox %}
			<tr id="message_row">
				<td><a href="/members/{{ item.sender }}/">
						{% for pic in item.sender.userpicture_set.all %}
	                		{% if forloop.first %}
	                		<img src='{{ MEDIA_URL }}{{ pic }}' alt="Owl Image" id="message_image" name="{{ pic.id }}"></div>
	                		{% endif %}
	                	{% endfor %}

					{{ item.sender }}</a>
				</td>
				<td id="inbox_body">
					{% if item.read %}
						<span style='color: grey;' class='glyphicon glyphicon-ok'></span>
					{% endif %}
					<a {% if item.read %} style='color: grey;' {% endif %} href= '{{ item.get_absolute_url }}'>{{ item.body|truncatechars:"30" }}</a>
					{% if item.sent %}
				</td>
				
						<small>{{ item.sent }}</small> 
					{% endif %}
				<td>
					<input id="delete_message" type="checkbox" name="{{ item.id }}"></input> 
				</td>

			</tr>
			{% endfor %}
		</body>

	</table>
</div>
</div>
</div>
<br>
<br>
</div>

<script type="text/javascript">
$(function ()
{
    if ($( '#items_table' ).length > 0)
    {
        var table = $( '#items_table' );

        table
            .find( 'tbody input[type=checkbox]' )
            .click(function()
            {
                // Get the ID of the item to delete
                var item_id = $(this).val();

                // Post it to the server
                $("#inbox_trash").click(function(){
	                $.post
	                (
	                    '',
	                    function(data)
	                    {
	                        // Assuming the page will return true
	                        if( data )
	                        {
	                            // Remove the table row
	                            
	                            $(this)
	                                .closest('tr')
	                                .slideUp()
	                                .remove()
	                            .end();
	                        }
	                    }
	                );
               });
            });
    }
});
</script>


{% endblock %}